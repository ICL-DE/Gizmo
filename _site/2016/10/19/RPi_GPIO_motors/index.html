<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Python / Raspberry Pi Learning!"">

    <title>Adafruit DC Motor HAT for Raspberry Pi - Gizmo Workshop</title>

    <link rel="canonical" href="https://starignus.github.io/PythonPractise//PythonPractise//2016/10/19/RPi_GPIO_motors/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/PythonPractise//css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/PythonPractise//css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/PythonPractise//css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="https://starignus.github.io/PythonPractise//feed.xml" title="Gizmo Workshop" />

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/PythonPractise//">Gizmo Workshop</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/PythonPractise//">Home</a>
                </li>
                
				
                <li>
                    <a href="/PythonPractise//about/">About Gizmo</a>
                </li>
				
                
				
                <li>
                    <a href="/PythonPractise//contact/">Contact</a>
                </li>
				
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/PythonPractise//img/post-bg-03.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Adafruit DC Motor HAT for Raspberry Pi</h1>
                    
                    <h2 class="subheading">Playing with motors</h2>
                    
                    <span class="meta">Posted by Ariadna Blanca Romero & Jing Sheng Pang on October 19, 2016</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<h1 id="raspberry-pi-gpio-part-2-adafruit-dc-motor-hat-for-raspberry-pi">Raspberry Pi GPIO-Part 2: Adafruit DC Motor HAT for Raspberry Pi</h1>

<h2 id="overview">Overview</h2>

<p>The <strong>DC+Stepper Motor HAT from Adafruit</strong> is a perfect add-on for any motor project as it can drive up to 4 DC or 2 Stepper motors with full PWM speed control. However, the Raspberry Pi does not have a lot of PWM pins, we use a fully-dedicated PWM driver chip onboard to both control motor direction and speed. This chip handles all the motor and speed controls over I2C. Only two GPIO pins (SDA &amp; SCL) are required to drive the multiple motors, and since it is I2C you can also connect any other I2C devices or HATs to the same pins.</p>

<p><strong>Note:</strong> <a href="(https://learn.adafruit.com/adafruits-raspberry-pi-lesson-4-gpio-setup/configuring-i2c)">I2C</a> is a very commonly used standard designed to allow one chip to talk to another. So, since the Raspberry Pi can talk I2C we can connect it to a variety of I2C capable chips and modules.</p>

<h5 id="features">Features:</h5>

<ul>
  <li>4 H-Bridges: TB6612 MOSFET chipset provides 1.2A per bridge (3A brief peak) with thermal shutdown protection, internal kickback protection diodes. Can run motors on 4.5VDC to 13.5VDC.</li>
  <li><strong>Up to 4 bi-directional DC motors</strong> with individual 8-bit speed selection (so, about 0.5% resolution).</li>
  <li><strong>Up to 2 stepper motors</strong> (unipolar or bipolar) with single coil, double coil, interleaved or micro-stepping.</li>
  <li>Big terminal block connectors to easily hook up wires (18-26AWG) and power.</li>
  <li>Polarity protected 2-pin terminal block and jumper to connect external 5-12VDC power.</li>
  <li>Install the easy-to-use Python library.</li>
</ul>

<h2 id="assembly">Assembly</h2>

<p><strong>The Motor HAT</strong> comes with an assembled and tested HAT, terminal blocks, and 2x20 plain header. Some soldering is required to assemble the headers on. Here we leave a link with a <a href="https://learn.adafruit.com/adafruit-dc-and-stepper-motor-hat-for-raspberry-pi/assembly">step-by-step</a> guide of how to solder the headers and a video to show you <a href="https://www.youtube.com/watch?v=QKbJxytERvg">tips on soldering</a>.</p>

<p><img src="https://starignus.github.io/PythonPractise//assets/raspberry_pi_2348_top_ORIG.jpg" alt="rpi" style="width: 400px;" /></p>

<p>Once the motor HAT is assembled, we place it on top so that the short pins of the 2x20 header line up with the pads on the HAT.</p>

<p><img src="https://starignus.github.io/PythonPractise//assets/raspberry_pi_place.jpg" alt="rpi-hat" style="width: 400px;" /></p>

<h2 id="powering-motors">Powering Motors</h2>

<p>Note the HAT does not power the Raspberry Pi, and we strongly recommend having two separate power supplies - one for the RPi and one for the motors, as motors can put a lot of noise onto a power supply and it could cause stability problems.</p>

<h5 id="voltage-requirements">Voltage requirements</h5>

<p>The motor controllers on this HAT are designed to run from <strong>5V to 12V</strong>. Therefore, the first important thing is to verify the voltage specifications for the motor. Some small hobby motors are only intended to run at 1.5V (<strong>MOST 1.5-3V MOTORS WILL NOT WORK or will be damaged by 5V power</strong>), but its just as common to have 6-12V motors.</p>

<h5 id="current-requirements">Current requirements</h5>

<p>The motor driver chips that come with the kit are designed to provide up to <strong>1.2 A per motor</strong>, with 3A peak current. Note that once you head towards 2A you will probably want to put a heat-sink on the motor driver, otherwise you will get thermal failure, possibly burning out the chip.</p>

<p><strong>Am important thing you can not run motors off of a 9V battery so don’t waste your time/batteries!</strong></p>

<p>Therefore, you can use a 9V 1A, 12V 1A, or 12V 5A DC regulated switching power adapter. In case you want to make it portable, you can use a big Lead Acid or multiple-AA NiMH battery pack of 4 to 8 batteries to vary the voltage from about 6V to 12V as your motors require.</p>

<p><img src="https://starignus.github.io/PythonPractise//assets/raspberry_pi_powerplug.jpg" alt="hat-power" style="width: 400px;" /></p>

<h2 id="connecting-dc-motors">Connecting DC Motors</h2>

<p>To connect a motor, simply solder two wires to the terminals and then connect them to either the <strong>M1, M2, M3</strong>, or <strong>M4</strong>. If your motor is running ‘backwards’ from the way you like, just swap the wires in the terminal block. For this demo, please connect it to <strong>M3</strong>.</p>

<p><img src="https://starignus.github.io/PythonPractise//assets/raspberry_pi_dcmotor.jpg" alt="hat-power" style="width: 400px;" /></p>

<h2 id="installing-software">Installing Software</h2>

<ul>
  <li>We can download the Python library to control DC and stepper motors. Before you start, we need to install the <strong>python smbus library</strong> as well as ‘git’. For the latter, execute the following command:</li>
</ul>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo apt-get install python-smbus
</code></pre>
</div>

<ul>
  <li>Now, we download the code as:</li>
</ul>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">cd </span>code
<span class="gp">$ </span>git clone https://github.com/adafruit/Adafruit-Motor-HAT-Python-Library.git
<span class="gp">$ </span><span class="nb">cd </span>Adafruit-Motor-HAT-Python-Library
<span class="gp">$ </span>sudo python setup.py install
</code></pre>
</div>

<ul>
  <li>Before going further to the next step, we need to configuring the I2C if has not been done yet. Run:</li>
</ul>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo raspi-config
</code></pre>
</div>

<p>and follow the prompts to install I2C support for the ARM core and linux kernel:</p>

<p><img src="https://starignus.github.io/PythonPractise//assets/I2C_1.png" alt="I2C_1" style="width: 650px;" /></p>

<p><img src="https://starignus.github.io/PythonPractise//assets/I2C_2.png" alt="I2C_2" style="width: 650px;" /></p>

<p><img src="https://starignus.github.io/PythonPractise//assets/I2C_3.png" alt="I2C_3" style="width: 650px;" /></p>

<p><img src="https://starignus.github.io/PythonPractise//assets/I2C_4.png" alt="I2C_4" style="width: 650px;" /></p>

<p><img src="https://starignus.github.io/PythonPractise//assets/I2C_5.png" alt="I2C_5" style="width: 650px;" /></p>

<p><strong>Then reboot!</strong></p>

<ul>
  <li>Now you can get started with testing to  watch your motor spin back and forth. First access to:</li>
</ul>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">cd </span>Adafruit-Motor-HAT-Python/examples
<span class="gp">$ </span>nano DCTest.py
</code></pre>
</div>
<p>Here you will see the code which shows you everything the MotorHAT library can do and how to do it.</p>

<h4 id="dc-motor-control">DC motor control</h4>

<ol>
  <li>Start with importing at least these libraries:</li>
</ol>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#!/usr/bin/python</span>
<span class="kn">from</span> <span class="nn">Adafruit_MotorHAT</span> <span class="kn">import</span> <span class="n">Adafruit_MotorHAT</span><span class="p">,</span> <span class="n">Adafruit_DCMotor</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">atexit</span>
</code></pre>
</div>

<ol>
  <li>The MotorHAT library contains a few different classes, one is the <strong>MotorHAT class</strong> itself which is the main PWM controller. You always need to create an object, and set the address (or frequency). By default the address is 0x60. We can change this address, but for now we are not going to do it.</li>
</ol>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># create a default object, no changes to I2C address or frequency</span>
<span class="n">mh</span> <span class="o">=</span> <span class="n">Adafruit_MotorHAT</span><span class="p">(</span><span class="n">addr</span><span class="o">=</span><span class="mh">0x60</span><span class="p">)</span>
</code></pre>
</div>

<ol>
  <li>The PWM driver is ‘free running’ - that means that even if the python code or Pi linux kernel crashes, the PWM driver will still continue to work. But it means that the motors <strong>DO NOT STOP</strong> when the python code quits
For that reason, we strongly recommend this ‘at exit’ code when using DC motors, it will do its best to shut down all the motors.</li>
</ol>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># recommended for auto-disabling motors on shutdown!</span>
<span class="k">def</span> <span class="nf">turnOffMotors</span><span class="p">():</span>
	<span class="n">mh</span><span class="o">.</span><span class="n">getMotor</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Adafruit_MotorHAT</span><span class="o">.</span><span class="n">RELEASE</span><span class="p">)</span>
	<span class="n">mh</span><span class="o">.</span><span class="n">getMotor</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Adafruit_MotorHAT</span><span class="o">.</span><span class="n">RELEASE</span><span class="p">)</span>
	<span class="n">mh</span><span class="o">.</span><span class="n">getMotor</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Adafruit_MotorHAT</span><span class="o">.</span><span class="n">RELEASE</span><span class="p">)</span>
	<span class="n">mh</span><span class="o">.</span><span class="n">getMotor</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Adafruit_MotorHAT</span><span class="o">.</span><span class="n">RELEASE</span><span class="p">)</span>

<span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">turnOffMotors</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="creating-the-dc-motor-object">Creating the DC motor object</h4>

<ol>
  <li>Now that you have the motor HAT object, note that each HAT can control up to 4 motors. That means you can have multiple HATs running.
To create the actual DC motor object, you can request it from the MotorHAT object you created above with <code class="highlighter-rouge">getMotor(num)</code> with a value between 1 and 4, for the terminal number that the motor is attached to</li>
</ol>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># In this case is M3</span>
<span class="n">myMotor</span> <span class="o">=</span> <span class="n">mh</span><span class="o">.</span><span class="n">getMotor</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre>
</div>

<p>DC motors are simple beasts, you can basically only set the speed and direction.</p>

<h4 id="setting-dc-motor-speed">Setting DC Motor Speed</h4>

<ol>
  <li>To set the speed, call <code class="highlighter-rouge">setSpeed(speed)</code> where speed varies from 0 (off) to 255 (Maximum). This is the PWM duty cycle of the motor.</li>
</ol>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># set the speed to start, from 0 (off) to 255 (max speed)</span>
<span class="n">myMotor</span><span class="o">.</span><span class="n">setSpeed</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="setting-dc-motor-direction">Setting DC Motor Direction</h4>

<ol>
  <li>To set the direction, we use the funciton <code class="highlighter-rouge">run(direction)</code> where direction is a constant from one of the following:
7.
    <ul>
      <li><code class="highlighter-rouge">Adafruit_MotorHAT.FORWARD</code> - DC motor spins forward.</li>
      <li><code class="highlighter-rouge">Adafruit_MotorHAT.BACKWARD</code> - DC motor spins backward.</li>
      <li><code class="highlighter-rouge">Adafruit_MotorHAT.RELEASE</code> - DC motor is ‘off’, not spinning but will also not hold its place.</li>
    </ul>
  </li>
</ol>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">while</span> <span class="p">(</span><span class="bp">True</span><span class="p">):</span>
	<span class="k">print</span> <span class="s">"Forward! "</span>
	<span class="n">myMotor</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Adafruit_MotorHAT</span><span class="o">.</span><span class="n">FORWARD</span><span class="p">)</span>

	<span class="k">print</span> <span class="s">"</span><span class="se">\t</span><span class="s">Speed up..."</span>
  <span class="c"># This will loop from 0-254</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">255</span><span class="p">):</span>
		<span class="n">myMotor</span><span class="o">.</span><span class="n">setSpeed</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="c"># It will stop 10 ms</span>
		<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

	<span class="k">print</span> <span class="s">"</span><span class="se">\t</span><span class="s">Slow down..."</span>
  <span class="c"># This will loop from 244-0</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">255</span><span class="p">)):</span>
		<span class="n">myMotor</span><span class="o">.</span><span class="n">setSpeed</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
		<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

	<span class="k">print</span> <span class="s">"Backward! "</span>
	<span class="n">myMotor</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Adafruit_MotorHAT</span><span class="o">.</span><span class="n">BACKWARD</span><span class="p">)</span>

	<span class="k">print</span> <span class="s">"</span><span class="se">\t</span><span class="s">Speed up..."</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">255</span><span class="p">):</span>
		<span class="n">myMotor</span><span class="o">.</span><span class="n">setSpeed</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
		<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

	<span class="k">print</span> <span class="s">"</span><span class="se">\t</span><span class="s">Slow down..."</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">255</span><span class="p">)):</span>
		<span class="n">myMotor</span><span class="o">.</span><span class="n">setSpeed</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
		<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

	<span class="k">print</span> <span class="s">"Release"</span>
	<span class="n">myMotor</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Adafruit_MotorHAT</span><span class="o">.</span><span class="n">RELEASE</span><span class="p">)</span>
	<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</code></pre>
</div>

<p>Reference[<a href="https://learn.adafruit.com/adafruit-dc-and-stepper-motor-hat-for-raspberry-pi/overview">1</a>, <a href="https://learn.adafruit.com/adafruits-raspberry-pi-lesson-4-gpio-setup/configuring-i2c#installing-kernel-support-manually">2</a>]</p>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/PythonPractise/2016/10/19/Rpi_GPIO/" data-toggle="tooltip" data-placement="top" title="Raspberry Pi GPIO">&larr; Previous Post</a>
                    </li>
                    
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/PythonPractise//feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/starignus">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/starignus">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/starignus/PythonPractise">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="mailto:ariadna@starignus.com, j.pang10@alumni.imperial.ac.uk">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; starignus 2016</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/PythonPractise//js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/PythonPractise//js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/PythonPractise//js/clean-blog.min.js "></script>


    


</body>

</html>
